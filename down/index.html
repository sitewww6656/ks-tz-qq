<html lang="zh-CN">
<head>
  <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="yes" name="apple-touch-fullscreen">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <title>官方认证-安全访问</title>
  <!-- 引入二维码生成库 -->
  <script src="https://cdn.bootcdn.net/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #fff;
    }

    /* 主容器 - 完全居中 */
    .container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      text-align: center;
    }

    /* 安全标志 */
    .security-badge {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .security-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #28a745;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      margin-right: 8px;
    }

    .security-subtext {
      font-size: 14px;
      color: #28a745;
    }

    /* 主标题 */
    .main-title {
      font-size: 22px;
      color: #28a745;
      font-weight: bold;
      margin: 15px 0;
    }

    /* 二维码提示 */
    .qrcode-desc {
      font-size: 15px;
      color: #666;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    /* 二维码容器 - 居中显示 */
    .qrcode-box {
      width: 240px;
      height: 240px;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      margin-bottom: 25px;
    }

    #qrcode {
      width: 100%;
      height: 100%;
    }

    /* 操作步骤 */
    .steps {
      width: 100%;
      max-width: 300px;
      margin-bottom: 20px;
    }

    .step {
      display: flex;
      align-items: flex-start;
      margin-bottom: 12px;
      font-size: 14px;
      color: #333;
    }

    .step-num {
      width: 22px;
      height: 22px;
      background: #28a745;
      color: white;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 12px;
      margin-right: 10px;
      flex-shrink: 0;
      margin-top: 1px;
    }

    /* 浏览器下载提示 */
    .browser-tip {
      color: #28a745;
      font-size: 15px;
      font-weight: 500;
      display: none;
    }

    /* 微信遮罩层 */
    .wechat-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 9999;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .overlay-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 300px;
      width: 100%;
    }

    .overlay-title {
      color: #dc3545;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      text-align: center;
    }

    .overlay-step {
      display: flex;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .overlay-step-num {
      width: 24px;
      height: 24px;
      background: #dc3545;
      color: white;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-right: 10px;
      flex-shrink: 0;
    }

    .overlay-confirm {
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 0;
      width: 100%;
      margin-top: 15px;
      font-size: 15px;
      cursor: pointer;
    }

    /* iframe容器 */
    .content {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      border: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 安全标志 -->
    <div class="security-badge">
      <div class="security-icon">✓</div>
      <div class="main-title">官方安全验证通过</div>
    </div>

    <!-- 二维码提示 -->
    <div class="qrcode-desc">截图保存二维码 或 直接微信扫码访问</div>

    <!-- 二维码容器 -->
    <div class="qrcode-box">
      <div id="qrcode"></div>
    </div>

    <!-- 操作步骤 -->
    <div class="steps">
      <div class="step">
        <div class="step-num">1</div>
        <div>截图保存二维码 或 直接扫码访问</div>
      </div>
      <div class="step">
        <div class="step-num">2</div>
        <div>浏览器自动启动下载，无需额外操作</div>
      </div>
    </div>

    <!-- 浏览器下载提示 -->
    <div class="browser-tip" id="browserTip">已在浏览器打开，正在自动下载...</div>
  </div>

  <!-- 微信遮罩层 -->
  <div class="wechat-overlay" id="wechatOverlay">
    <div class="overlay-content">
      <div class="overlay-title">微信内无法直接下载</div>
      <div class="overlay-step">
        <div class="overlay-step-num">1</div>
        <div>点击右上角「···」图标</div>
      </div>
      <div class="overlay-step">
        <div class="overlay-step-num">2</div>
        <div>选择「在浏览器打开」</div>
      </div>
      <button class="overlay-confirm" onclick="hideWechatOverlay()">知道了</button>
    </div>
  </div>

  <script>
    // 检测微信浏览器
    function isWechatBrowser() {
      return navigator.userAgent.toLowerCase().includes('micromessenger');
    }

    // 隐藏微信遮罩层
    function hideWechatOverlay() {
      document.getElementById('wechatOverlay').style.display = 'none';
    }

    // 生成二维码
    function initQrcode() {
      try {
        new QRCode(document.getElementById('qrcode'), {
          text: window.location.href,
          width: 210,
          height: 210,
          colorDark: '#000',
          colorLight: '#fff',
          correctLevel: QRCode.CorrectLevel.H
        });
      } catch (e) {
        document.getElementById('qrcode').innerHTML = '<div style="color:#f00;font-size:14px;text-align:center;line-height:210px;">二维码生成失败</div>';
      }
    }

    // 解析参数并处理下载
    (function() {
      const urlParams = new URLSearchParams(window.location.search);
      const encodedParam = urlParams.get('c');
      const tureurl = encodedParam ? atob(encodedParam) : '';

      // 初始化二维码
      initQrcode();

      // 微信环境处理
      if (isWechatBrowser()) {
        document.getElementById('wechatOverlay').style.display = 'flex';
      } else {
        // 非微信环境显示下载提示
        document.getElementById('browserTip').style.display = 'block';
      }

      // 加载下载链接
      if (tureurl && tureurl.includes('http')) {
        const html = `<iframe class="content" onload="bindMouseWhee(this)" src="${tureurl}"></iframe>`;
        document.writeln(html);
      }
    })();
  </script>

  <!-- 鼠标滚轮事件处理 -->
  <script>
    var firefox = navigator.userAgent.indexOf('Firefox') != -1;

    function MouseWheel(e, doc) {
      try {
        e.preventDefault && e.preventDefault();
        e.returnValue = false;
        var up = firefox && e.detail < 0 || e.wheelDelta > 0;
        doc.body.scrollTop = doc.documentElement.scrollTop += up ? -50 : 50;
      } catch (e) {
        console.log('跨域环境下无法控制滚动:', e);
      }
    }

    function bindMouseWhee(ifr) {
      try {
        var isSameOrigin = false;
        try {
          var iframeOrigin = new URL(ifr.src).origin;
          isSameOrigin = window.location.origin === iframeOrigin;
        } catch (e) {
          console.log('无法验证同源性:', e);
        }

        if (isSameOrigin) {
          var doc = ifr.contentWindow.document;
          if (firefox) {
            doc.addEventListener('DOMMouseScroll', function(e) {
              MouseWheel(e, doc);
            }, false);
          } else {
            doc.onmousewheel = function(e) {
              MouseWheel(e || ifr.contentWindow.event, doc);
            };
          }
        } else {
          console.log('检测到跨域iframe，不绑定滚动事件');
        }
      } catch (e) {
        console.log('绑定滚动事件失败:', e);
      }
    }
  </script>
</body>
</html>
